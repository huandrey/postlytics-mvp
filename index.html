<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Host Page</title>
</head>
<body>
  <h1>Host Page</h1>

  <!-- Iframe que age como tag manager -->
  <iframe
    id="tag-frame"
    src="iframe.html"
    width="100%"
    height="400"
    style="border: 1px solid #ccc"
  ></iframe>

  <script>
    const iframe = document.getElementById("tag-frame");

    // Enviar contexto para o iframe ao carregar
    iframe.onload = () => {
      iframe.contentWindow.postMessage({
        type: "INIT_CONTEXT",
        payload: {
          user: { id: "123", email: "teste@email.com" },
          app: { name: "MeuApp", version: "1.0.0" }
        }
      }, "*");
    };

    // Receber dados do iframe
    window.addEventListener("message", (event) => {
      if (!event.data || typeof event.data !== "object") return;

      const { type, payload } = event.data;
      console.log("[HOST] Recebido:", type, payload);

      // VocÃª pode agir de acordo com o tipo
      switch (type) {
        case "WEB_VITAL":
        case "ERROR":
        case "IMPRESSION":
        case "CLICK":
          // Enviar para analytics, log, etc
          break;
      }
    });
  </script>
</body>
</html>
